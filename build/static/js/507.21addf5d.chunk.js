"use strict";(self.webpackChunkthetower=self.webpackChunkthetower||[]).push([[507],{53016:(e,i,s)=>{s.d(i,{Z:()=>r});s(72791);var t=s(2409),a=s(49389),n=s(80184);const r=e=>{let{label:i,name:s,required:r,required_text:l,warning:d}=e;return(0,n.jsx)(t.Z.Item,{label:d?(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:i}),(0,n.jsx)("br",{}),(0,n.jsx)("p",{children:d})]}):(0,n.jsx)("div",{children:i}),name:s,rules:[{required:r,message:l}],children:(0,n.jsx)(a.default,{})})}},83386:(e,i,s)=>{s.d(i,{Z:()=>r});s(72791);var t=s(2409),a=s(66920),n=s(80184);const r=e=>{let{label:i,name:s,required:r,required_text:l}=e;return(0,n.jsx)(t.Z.Item,{label:i,name:s,rules:[{required:r,message:l}],children:(0,n.jsx)(a.Z,{rows:4})})}},17507:(e,i,s)=>{s.r(i),s.d(i,{default:()=>j});var t=s(72791),a=s(2409),n=s(50419),r=s(66106),l=s(30914),d=s(93086),o=s(87309),u=s(91933),c=s(27169),m=s(94533),p=s(57689),g=s(16030),v=s(68117),_=s(77221),h=s(53016),x=s(83386),Z=s(80184);const f={main_image_id:[],image_ids:[],title_uz:"",title_ru:"",title_en:"",description_ru:"",description_uz:"",description_en:""},j=()=>{const[e]=a.Z.useForm(),i=(0,p.s0)(),{editId:s}=(0,g.v9)((e=>e.editData)),j=(0,g.I0)(),[w,b]=(0,t.useState)([]),[S,q]=(0,t.useState)([]),[F,y]=(0,t.useState)(""),{mutate:I,data:z,isLoading:D,isSuccess:E}=(0,u.useMutation)((e=>{let{url:i,formData:s}=e;return c.Z.postData(i,s)}),{onSuccess:()=>{n.ZP.success("Success")},onError:e=>{for(let i in e.response.data)n.ZP.error("".concat(i,": ").concat(e.response.data[i][0]))}}),{mutate:P,data:L,isLoading:V,isSuccess:k}=(0,u.useMutation)((e=>{let{url:i,data:s}=e;return c.Z.postData(i,s)}),{onSuccess:()=>{n.ZP.success("Success")},onError:e=>{for(let i in e.response.data)n.ZP.error("".concat(i,": ").concat(e.response.data[i][0]))}}),{isLoading:C,data:T,refetch:U,isSuccess:R}=(0,u.useQuery)(["edit-news",s],(()=>c.Z.getDataByID("/pages/news",s)),{enabled:!1}),{mutate:M,isLoading:O,data:A,isSuccess:J}=(0,u.useMutation)((e=>{let{url:i,data:s,id:t}=e;return c.Z.editData(i,s,t)}),{onSuccess:()=>{n.ZP.success("Success")},onError:e=>{for(let i in e.response.data)n.ZP.error("".concat(i,": ").concat(e.response.data[i][0]))}}),{mutate:N}=(0,u.useMutation)((e=>{let{url:i,ids:s}=e;return c.Z.deleteImages(i,s)}),{onSuccess:()=>n.ZP.success("Success"),onError:e=>n.ZP.error(e.message)});(0,t.useEffect)((()=>{J&&j({type:_.Pb,payload:""}),(k||J)&&i("/news")}),[L,A]),(0,t.useEffect)((()=>{""!==s&&U()}),[s]),(0,t.useEffect)((()=>{""===s&&e.setFieldsValue(f)}),[]),(0,t.useEffect)((()=>{const i=[];let s=null;if(void 0!==T&&(T.images.map((e=>{const s={uid:e.id,name:e.id,status:"done",url:e.image};i.push(s)})),s=[{uid:null===T||void 0===T?void 0:T.main_image.id,name:null===T||void 0===T?void 0:T.main_image.id,status:"done",url:null===T||void 0===T?void 0:T.main_image.image}]),R){const t={title_uz:null===T||void 0===T?void 0:T.title_uz,title_ru:null===T||void 0===T?void 0:T.title_ru,title_en:null===T||void 0===T?void 0:T.title_en,description_ru:null===T||void 0===T?void 0:T.description_ru,description_uz:null===T||void 0===T?void 0:T.description_uz,description_en:null===T||void 0===T?void 0:T.description_en,image_ids:i,main_image_id:s};b(i),q(s),e.setFieldsValue(t)}}),[T]);(0,t.useEffect)((()=>{const i=JSON.parse(localStorage.getItem("myFormValues"));i&&(i.images=[],e.setFieldsValue(i));const s=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",s),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",s)}}),[]),(0,t.useEffect)((()=>{if(E&&"images"===F){var i,s,t;const a=[...w],n={uid:null===z||void 0===z||null===(i=z.images[0])||void 0===i?void 0:i.id,name:null===z||void 0===z||null===(s=z.images[0])||void 0===s?void 0:s.id,status:"done",url:null===z||void 0===z||null===(t=z.images[0])||void 0===t?void 0:t.url};a.push(n),e.setFieldsValue({image_ids:[n]}),b(a),y("")}if(E&&"mainImage"===F){var a,n,r;const i=[{uid:null===z||void 0===z||null===(a=z.images[0])||void 0===a?void 0:a.id,name:null===z||void 0===z||null===(n=z.images[0])||void 0===n?void 0:n.id,status:"done",url:null===z||void 0===z||null===(r=z.images[0])||void 0===r?void 0:r.url}];e.setFieldsValue({main_image_id:i}),q(i),y("")}}),[z]);const Q=async e=>{let i=e.url;i||(i=await new Promise((i=>{const s=new FileReader;s.readAsDataURL(e.originFileObj),s.onload=()=>i(s.result)})));const s=new Image;s.src=i;const t=window.open(i);null===t||void 0===t||t.document.write(s.outerHTML)};return(0,Z.jsx)("div",{children:V||C||O||D?(0,Z.jsx)(m.QP,{}):(0,Z.jsxs)(a.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:f,onFinish:e=>{var i;const t=[];w.map((e=>{t.push(e.uid)}));const a={image_ids:t,main_image_id:null===(i=S[0])||void 0===i?void 0:i.uid,title_uz:e.title_uz,title_ru:e.title_ru,title_en:e.title_en,description_ru:e.description_ru,description_uz:e.description_uz,description_en:e.description_en};R?M({url:"/pages/news",data:a,id:s}):P({url:"/pages/news/",data:a})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,Z.jsxs)(r.Z,{gutter:20,children:[(0,Z.jsx)(l.Z,{span:24,children:(0,Z.jsx)(h.Z,{required:!0,required_text:"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u0432\u0435\u0441\u0442\u0438 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a",label:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a Ru",name:"title_ru"})}),(0,Z.jsx)(l.Z,{span:24,children:(0,Z.jsx)(h.Z,{required:!0,required_text:"Sarlavha kiritish kerak",label:"Sarlavha Uz",name:"title_uz"})}),(0,Z.jsx)(l.Z,{span:24,children:(0,Z.jsx)(h.Z,{required:!0,required_text:"A title is required",label:"Title En",name:"title_en"})})]}),(0,Z.jsxs)(r.Z,{gutter:20,children:[(0,Z.jsx)(l.Z,{span:24,children:(0,Z.jsx)(x.Z,{required:!0,required_text:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",label:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 Ru",name:"description_ru"})}),(0,Z.jsx)(l.Z,{span:24,children:(0,Z.jsx)(x.Z,{required:!0,required_text:"Tavsif kiritish kerak",label:"Tavsif Uz",name:"description_uz"})}),(0,Z.jsx)(l.Z,{span:24,children:(0,Z.jsx)(x.Z,{required:!0,required_text:"A description is required",label:"Description En",name:"description_en"})})]}),(0,Z.jsxs)(r.Z,{gutter:20,children:[(0,Z.jsx)(l.Z,{span:12,children:(0,Z.jsx)(a.Z.Item,{label:"\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438",name:"main_image_id",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,Z.jsx)(v.Z,{children:(0,Z.jsx)(d.Z,{maxCount:1,fileList:S,listType:"picture-card",onChange:e=>{let{fileList:i}=e;const s=new FormData;0!==i.length&&(s.append("uploaded_images",i[0].originFileObj),I({url:"/images/",formData:s}),y("mainImage"))},onPreview:Q,onRemove:i=>{const s={image_ids:[null===i||void 0===i?void 0:i.uid]};N({url:"/images/delete",ids:s}),q([]),e.setFieldsValue({main_image_id:[]})},beforeUpload:()=>!1,children:S.length>0?"":"Upload"})})})}),(0,Z.jsx)(l.Z,{span:12,children:(0,Z.jsx)(a.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",name:"image_ids",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,Z.jsx)(v.Z,{children:(0,Z.jsx)(d.Z,{maxCount:5,fileList:w,listType:"picture-card",onChange:e=>{let{fileList:i}=e;if(i.length<w.length)return;const s=new FormData;0!==i.length&&(s.append("uploaded_images",i[i.length-1].originFileObj),I({url:"/images/",formData:s}),y("images"))},onPreview:Q,onRemove:i=>{const s=[];w.map((e=>{(null===e||void 0===e?void 0:e.uid)!==(null===i||void 0===i?void 0:i.uid)&&s.push(e)})),!s.length>0&&e.setFieldsValue({image_ids:[]});const t={image_ids:[null===i||void 0===i?void 0:i.uid]};N({url:"/images/delete",ids:t}),b(s)},beforeUpload:()=>!1,children:w.length>4?"":"Upload"})})})})]}),(0,Z.jsx)(o.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:R?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u043e\u0434\u0443\u043a\u0442":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0434\u0443\u043a\u0442"})]})})}}}]);
//# sourceMappingURL=507.21addf5d.chunk.js.map