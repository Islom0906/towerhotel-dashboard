"use strict";(self.webpackChunkthetower=self.webpackChunkthetower||[]).push([[39],{53016:(e,i,a)=>{a.d(i,{Z:()=>r});a(72791);var t=a(2409),s=a(49389),l=a(80184);const r=e=>{let{label:i,name:a,required:r,required_text:d,warning:n}=e;return(0,l.jsx)(t.Z.Item,{label:n?(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:i}),(0,l.jsx)("br",{}),(0,l.jsx)("p",{children:n})]}):(0,l.jsx)("div",{children:i}),name:a,rules:[{required:r,message:d}],children:(0,l.jsx)(s.default,{})})}},2039:(e,i,a)=>{a.r(i),a.d(i,{default:()=>Z});var t=a(72791),s=a(2409),l=a(50419),r=a(66106),d=a(30914),n=a(93086),o=a(87309),u=a(91933),c=a(27169),m=a(94533),g=a(57689),v=a(16030),h=a(68117),p=a(77221),_=a(53016),f=a(80184);const x={header_image_id:[],image_ids:[],title_uz:"",title_ru:"",title_en:""},Z=()=>{const[e]=s.Z.useForm(),i=(0,g.s0)(),{editId:a}=(0,v.v9)((e=>e.editData)),Z=(0,v.I0)(),[j,S]=(0,t.useState)([]),[b,w]=(0,t.useState)([]),[F,y]=(0,t.useState)(""),{mutate:I,data:D,isLoading:E,isSuccess:P}=(0,u.useMutation)((e=>{let{url:i,formData:a}=e;return c.Z.postData(i,a)}),{onSuccess:()=>{l.ZP.success("Success")},onError:e=>{for(let i in e.response.data)l.ZP.error("".concat(i,": ").concat(e.response.data[i][0]))}}),{mutate:q,data:L,isLoading:V,isSuccess:C}=(0,u.useMutation)((e=>{let{url:i,data:a}=e;return c.Z.postData(i,a)}),{onSuccess:()=>{l.ZP.success("Success")},onError:e=>{for(let i in e.response.data)l.ZP.error("".concat(i,": ").concat(e.response.data[i][0]))}}),{isLoading:k,data:z,refetch:T,isSuccess:U}=(0,u.useQuery)(["edit-gallery",a],(()=>c.Z.getDataByID("/pages/gallery",a)),{enabled:!1}),{mutate:M,isLoading:O,data:R,isSuccess:A}=(0,u.useMutation)((e=>{let{url:i,data:a,id:t}=e;return c.Z.editData(i,a,t)}),{onSuccess:()=>{l.ZP.success("Success")},onError:e=>{for(let i in e.response.data)l.ZP.error("".concat(i,": ").concat(e.response.data[i][0]))}}),{mutate:J}=(0,u.useMutation)((e=>{let{url:i,ids:a}=e;return c.Z.deleteImages(i,a)}),{onSuccess:()=>l.ZP.success("Success"),onError:e=>l.ZP.error(e.message)});(0,t.useEffect)((()=>{A&&Z({type:p.Pb,payload:""}),(C||A)&&i("/gallery")}),[L,R]),(0,t.useEffect)((()=>{""!==a&&T()}),[a]),(0,t.useEffect)((()=>{""===a&&e.setFieldsValue(x)}),[]),(0,t.useEffect)((()=>{const i=[];let a=null;if(void 0!==z&&(z.images.map((e=>{const a={uid:e.id,name:e.id,status:"done",url:e.image};i.push(a)})),a=[{uid:null===z||void 0===z?void 0:z.header_image.id,name:null===z||void 0===z?void 0:z.header_image.id,status:"done",url:null===z||void 0===z?void 0:z.header_image.image}]),U){const t={title_uz:null===z||void 0===z?void 0:z.title_uz,title_ru:null===z||void 0===z?void 0:z.title_ru,title_en:null===z||void 0===z?void 0:z.title_en,image_ids:i,header_image_id:a};S(i),w(a),e.setFieldsValue(t)}}),[z]);(0,t.useEffect)((()=>{const i=JSON.parse(localStorage.getItem("myFormValues"));i&&(i.images=[],e.setFieldsValue(i));const a=()=>{localStorage.setItem("myFormValues",JSON.stringify(e.getFieldsValue()))};return window.addEventListener("beforeunload",a),()=>{localStorage.removeItem("editDataId"),localStorage.removeItem("myFormValues"),window.removeEventListener("beforeunload",a)}}),[]),(0,t.useEffect)((()=>{if(P&&"images"===F){var i,a,t;const s=[...j],l={uid:null===D||void 0===D||null===(i=D.images[0])||void 0===i?void 0:i.id,name:null===D||void 0===D||null===(a=D.images[0])||void 0===a?void 0:a.id,status:"done",url:null===D||void 0===D||null===(t=D.images[0])||void 0===t?void 0:t.url};s.push(l),e.setFieldsValue({image_ids:[l]}),S(s),y("")}if(P&&"headerImage"===F){var s,l,r;const i=[{uid:null===D||void 0===D||null===(s=D.images[0])||void 0===s?void 0:s.id,name:null===D||void 0===D||null===(l=D.images[0])||void 0===l?void 0:l.id,status:"done",url:null===D||void 0===D||null===(r=D.images[0])||void 0===r?void 0:r.url}];e.setFieldsValue({header_image_id:i}),w(i),y("")}}),[D]);const N=async e=>{let i=e.url;i||(i=await new Promise((i=>{const a=new FileReader;a.readAsDataURL(e.originFileObj),a.onload=()=>i(a.result)})));const a=new Image;a.src=i;const t=window.open(i);null===t||void 0===t||t.document.write(a.outerHTML)};return(0,f.jsx)("div",{children:V||k||O||E?(0,f.jsx)(m.QP,{}):(0,f.jsxs)(s.Z,{form:e,name:"basic",labelCol:{span:24},wrapperCol:{span:24},style:{maxWidth:"100%"},initialValues:x,onFinish:e=>{var i;const t=[];j.map((e=>{t.push(e.uid)}));const s={image_ids:t,header_image_id:null===(i=b[0])||void 0===i?void 0:i.uid,title_uz:e.title_uz,title_ru:e.title_ru,title_en:e.title_en};U?M({url:"/pages/gallery",data:s,id:a}):q({url:"/pages/gallery/",data:s})},onFinishFailed:e=>{console.log("Failed:",e)},autoComplete:"off",children:[(0,f.jsxs)(r.Z,{gutter:20,children:[(0,f.jsx)(d.Z,{span:24,children:(0,f.jsx)(_.Z,{required:!0,required_text:"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u0432\u0435\u0441\u0442\u0438 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a",label:"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a Ru",name:"title_ru"})}),(0,f.jsx)(d.Z,{span:24,children:(0,f.jsx)(_.Z,{required:!0,required_text:"Sarlavha kiritish kerak",label:"Sarlavha Uz",name:"title_uz"})}),(0,f.jsx)(d.Z,{span:24,children:(0,f.jsx)(_.Z,{required:!0,required_text:"A title is required",label:"Title En",name:"title_en"})})]}),(0,f.jsxs)(r.Z,{gutter:20,children:[(0,f.jsx)(d.Z,{span:12,children:(0,f.jsx)(s.Z.Item,{label:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",name:"image_ids",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,f.jsx)(h.Z,{children:(0,f.jsx)(n.Z,{maxCount:10,fileList:j,listType:"picture-card",onChange:e=>{let{fileList:i}=e;if(i.length<j.length)return;const a=new FormData;0!==i.length&&(a.append("uploaded_images",i[i.length-1].originFileObj),I({url:"/images/",formData:a}),y("images"))},onPreview:N,onRemove:i=>{const a=[];j.map((e=>{(null===e||void 0===e?void 0:e.uid)!==(null===i||void 0===i?void 0:i.uid)&&a.push(e)})),!a.length>0&&e.setFieldsValue({image_ids:[]});const t={image_ids:[null===i||void 0===i?void 0:i.uid]};J({url:"/images/delete",ids:t}),S(a)},beforeUpload:()=>!1,children:j.length>9?"":"Upload"})})})}),(0,f.jsx)(d.Z,{span:12,children:(0,f.jsx)(s.Z.Item,{label:"\u0417\u0430\u0433\u043b\u0430\u0432\u043d\u043e\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435",name:"header_image_id",rules:[{required:!0,message:"\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}],children:(0,f.jsx)(h.Z,{children:(0,f.jsx)(n.Z,{maxCount:1,fileList:b,listType:"picture-card",onChange:e=>{let{fileList:i}=e;const a=new FormData;0!==i.length&&(a.append("uploaded_images",i[0].originFileObj),I({url:"/images/",formData:a}),y("headerImage"))},onPreview:N,onRemove:i=>{const a={image_ids:[null===i||void 0===i?void 0:i.uid]};J({url:"/images/delete",ids:a}),w([]),e.setFieldsValue({header_image_id:[]})},beforeUpload:()=>!1,children:b.length>0?"":"Upload"})})})})]}),(0,f.jsx)(o.Z,{type:"primary",htmlType:"submit",style:{width:"100%",marginTop:"20px"},children:U?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0440\u043e\u0434\u0443\u043a\u0442":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0440\u043e\u0434\u0443\u043a\u0442"})]})})}}}]);
//# sourceMappingURL=39.cb17dc6c.chunk.js.map